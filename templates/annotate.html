<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DREAMLENS AI - Annotate Dreams</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=2" />
  <style>body{font-family:Poppins, sans-serif;background:linear-gradient(135deg,#0a0014,#1a0033);color:#d0e8ff;margin:0;padding:0;} .container{padding-top:100px}</style>
</head>
<body>
  <div class="container" style="max-width:900px;margin:40px auto;padding:30px;">
    <div class="header" style="border-radius:12px;padding:20px;text-align:left;">
      <h1>Annotate Dreams</h1>
      <p>Label themes in dreams to build a supervised dataset.</p>
    </div>

    <div style="margin-top:20px;display:flex;gap:20px;">
      <div style="flex:1;">
        <textarea id="dreamText" placeholder="Paste or write a dream here..." style="width:100%;height:160px;padding:12px;border-radius:8px;background:rgba(15,5,30,0.6);color:#d0e8ff;border:1px solid rgba(100,200,255,0.12);"></textarea>
      </div>
      <div style="width:320px;">
        <label for="labelsInput">Labels (comma separated)</label>
        <input id="labelsInput" placeholder="fear, anxiety, loss" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(100,200,255,0.12);background:rgba(15,5,30,0.6);color:#d0e8ff;" />

        <label style="margin-top:12px;display:block">Notes</label>
        <textarea id="note" placeholder="Optional notes" style="width:100%;height:80px;padding:8px;border-radius:8px;background:rgba(15,5,30,0.6);color:#d0e8ff;border:1px solid rgba(100,200,255,0.12);"></textarea>

        <button id="saveBtn" style="margin-top:14px;padding:12px 18px;border-radius:10px;background:linear-gradient(135deg, rgba(100,200,255,0.5), rgba(147,51,234,0.6));border:none;cursor:pointer;color:white;font-weight:700;">Save Annotation</button>
        <div id="status" style="margin-top:10px;color:#b5a3ff;font-size:0.95em"></div>
      </div>
    </div>

    <div style="margin-top:24px;">
      <h3>Recent Annotations</h3>
      <div id="recentList" style="max-height:240px;overflow:auto;padding:8px;border-radius:8px;background:rgba(15,5,30,0.6);border:1px solid rgba(100,200,255,0.06);"></div>
    </div>
  </div>

  <script>
    async function fetchRecent() {
      const r = await fetch('/annotations/recent');
      const data = await r.json();
      const list = document.getElementById('recentList');
      list.innerHTML = '';
      data.recent.forEach(a => {
        const el = document.createElement('div');
        el.style.padding = '8px';
        el.style.borderBottom = '1px solid rgba(100,200,255,0.04)';
        el.innerHTML = `<div style="font-weight:700;color:#64c8ff">${a.labels.join(', ')}</div><div style="color:#d0e8ff;margin-top:6px">${a.dream}</div>`;
        list.appendChild(el);
      });
    }

    document.getElementById('saveBtn').addEventListener('click', async () => {
      const dream = document.getElementById('dreamText').value.trim();
      const labels = document.getElementById('labelsInput').value.split(',').map(s=>s.trim()).filter(Boolean);
      const note = document.getElementById('note').value.trim();
      if (!dream) { document.getElementById('status').textContent = 'Please enter a dream.'; return; }
      document.getElementById('status').textContent = 'Saving...';
      const res = await fetch('/annotations', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({dream, labels, note})});
      const data = await res.json();
      if (data.success) {
        document.getElementById('status').textContent = 'Saved âœ“';
        document.getElementById('dreamText').value = '';
        document.getElementById('labelsInput').value = '';
        document.getElementById('note').value = '';
        fetchRecent();
      } else {
        document.getElementById('status').textContent = 'Error saving annotation.';
      }
    });

    fetchRecent();
  </script>
</body>
</html>